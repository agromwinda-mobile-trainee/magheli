// ============================
//      FONCTIONS SP√âCIFIQUES AU STOCK
// ============================

// L'utilisateur ne peut toucher que le stock de sa propre activit√©
// CORRIG√â : Compare activityName (user) avec activity (stock)
// Syntaxe Firestore : utilisation d'op√©rateurs logiques au lieu de if
function isSameActivity() {
  let user = get(/databases/$(database)/documents/users/$(request.auth.uid)).data;
  let currentStock = resource.data;
  
  // V√©rifier que l'utilisateur a un activityName ET que le stock a un activity
  // Utilisation d'op√©rateurs logiques au lieu de if
  return ("activityName" in user) 
         && user.activityName != null
         && ("activity" in currentStock)
         && currentStock.activity != null
         && user.activityName == currentStock.activity;
}

// üî• V√©rifie que la mise √† jour DIMINUE la quantit√©
function isStockDecreaseOnly() {
  return request.resource.data.keys().hasOnly(["quantity", "updatedAt"])
         && request.resource.data.quantity < resource.data.quantity;
}

// üî• V√©rifie que la quantit√© finale ne devient pas n√©gative
function notGoingNegative() {
  return request.resource.data.quantity >= 0;
}



